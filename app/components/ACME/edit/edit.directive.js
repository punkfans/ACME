(function () {
    angular.module('app')
        .controller('editController', editController)
        .directive('editPage', editPage);

    function editController($routeParams, dataService, $location) {
        var vm = this;
        vm.item = dataService.getItem(parseInt($routeParams.id));
        // get all the keys for the label
        vm.keys = Object.keys(vm.item);

        // get rid of the id which should be generated instead of manually assigned
        // get rid of the $$hashKey generated by angular
        vm.keys = vm.keys.filter(function (key) {
           return key !== 'id' && key !== '$$hashKey';
        });

        vm.goBackToSearchPage = function () {
            // convert tags from string to array again, also have to trim each of the item
            // 'a, b, b' ===> ['a', 'b', 'c']
            vm.item.tags = vm.item.tags.split(',').map(function (value) {
                return value.trim();
            });

            $location.path('/search');
        }
    }

    function editPage() {
        return {
            restrict: 'E',
            controller: 'editController as edit',
            templateUrl: 'app/components/ACME/edit/edit.html'
        }
    }
})();